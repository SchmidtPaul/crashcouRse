<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Varianzstrukturen</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 54px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 59px;
  margin-top: -59px;
}

.section h2 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h3 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h4 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h5 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h6 {
  padding-top: 59px;
  margin-top: -59px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">crashcouRse</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Kapitel
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="1wayANOVA_crd.html">1) 1F crd</a>
    </li>
    <li>
      <a href="1wayANOVA_rcbd.html">2) 1F rcbd</a>
    </li>
    <li>
      <a href="1wayANOVA_alpha.html">3) 1F alpha</a>
    </li>
    <li>
      <a href="2wayANOVA_splitplot.html">4) 2F split-plot</a>
    </li>
    <li>
      <a href="rcbdrepmes.html">5) 1F rcbd Messwiederholungen</a>
    </li>
    <li>
      <a href="GLMbinomial.html">6) 1F crd Prozentwerte</a>
    </li>
    <li>
      <a href="GLMpoisson.html">7) 1F lat square Zählwerte</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="desplot.html">1) desplot package</a>
    </li>
    <li>
      <a href="DesignList.html">2) Versuchsdesigns</a>
    </li>
    <li>
      <a href="VarCovStr1.html">3) Varianzstrukturen</a>
    </li>
    <li>
      <a href="NichtNormalverteilt.html">4) Nicht-Normalverteilte Daten</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Kontakt.html">Kontakt</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Varianzstrukturen</h1>

</div>


<pre class="r"><code>library(data.table) # bessere Datenmanipulation
library(nlme)   # gemischtes Modell package 1
library(asreml) # gemischtes Modell package 2 - benötigt R version 3.2.3. und Lizenz</code></pre>
<div id="datensatz" class="section level1">
<h1>Datensatz</h1>
<p>In diesem Experiment wurde in einer randomisierten vollständigen Blockanlage (RCBD) mit 5 Wiederholungen der Blattflächenindex von 5 Sorghumsorten verglichen. Allerdings wurde der Blattflächenindex mehrfach, nämlich in 5 aufeinanderfolgenden Wochen, gemessen, sodass Messwiederholungen vorliegen.</p>
<blockquote>
<p>Dieses Beispiel basiert auf <em>Example 4</em> des <code>agriTutorial</code> packages und der dazugehörigen Veröffentlichung <br /> Piepho, H. P., &amp; Edmondson, R. N. (2018). A tutorial on the statistical analysis of factorial experiments with qualitative and quantitative treatment factor levels. Journal of Agronomy and Crop Science.</p>
</blockquote>
<p>Messwiederholungen werfen eine Neuerung gegenüber den vorangegangenen Beispielen auf: zum ersten Mal ist die kleinste Randomisationseinheit (=Parzelle) nicht gleichzeitig die Beobachtungseinheit, da wir mehrere Beobachtungen pro Parzelle haben. Der wichtige Punkt hier ist, dass der Faktor Woche nicht randomisiert werden kann. Statt der üblichen Annahme von unabhängigen Messwerten, sind Messwerte derselben Parzelle von aufeinanderfolgenden Wochen wahrscheinlich miteinander korreliert. Um dies zu modellieren, soll im ersten Schritt vorerst das Modell für die Analyse einer einzelnen Woche aufgestellt werden.</p>
<div class="row">
<div class="col-md-6">
<pre class="r"><code>print(repmes, nrows=10)</code></pre>
<pre><code>##      week gen  rep   plot    y row col
##   1:    1   A rep1  plot1 5.00   1   1
##   2:    1   D rep1  plot2 5.86   2   1
##   3:    1   B rep1  plot3 5.82   3   1
##   4:    1   C rep1  plot4 5.65   4   1
##   5:    1   C rep2  plot5 5.39   1   2
##  ---                                  
##  96:    5   B rep4 plot16 3.99   4   4
##  97:    5   D rep5 plot17 2.96   1   5
##  98:    5   C rep5 plot18 3.00   2   5
##  99:    5   B rep5 plot19 2.95   3   5
## 100:    5   A rep5 plot20 2.16   4   5</code></pre>
</div>
<div class="col-md-6">
<pre class="r"><code>str(repmes, width=40, strict.width=&quot;cut&quot;)</code></pre>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   100 obs. of  7 variables:
##  $ week: Factor w/ 5 levels &quot;1&quot;,&quot;2&quot;,&quot;&quot;..
##  $ gen : Factor w/ 4 levels &quot;A&quot;,&quot;B&quot;,&quot;&quot;..
##  $ rep : Factor w/ 5 levels &quot;rep1&quot;,&quot;r&quot;..
##  $ plot: Factor w/ 20 levels &quot;plot1&quot;,&quot;..
##  $ y   : num  5 5.86 5.82 5.65 5.39 4...
##  $ row : num  1 2 3 4 1 2 3 4 1 2 ...
##  $ col : num  1 1 1 1 2 2 2 2 3 3 ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;exter..</code></pre>
</div>
</div>
</div>
<div id="varianzstrukturen" class="section level1">
<h1>Varianzstrukturen</h1>
<p><img src="images/fig6corerr.PNG" style="width:50%" align="center"></p>
<div id="nlme-asreml-r" class="section level2">
<h2>nlme &amp; asreml-R</h2>
<p>Wir werden hier die Modelle mit der <code>gls()</code> Funktion aus dem <code>nlme</code> package anpassen. Zu jedem Modell wird auch das Gegenstück in <code>asreml()</code> Syntax gezeigt, allerdings nicht ausgeführt. Das asreml-R version 3.0 package funktioniert nur mit älteren R-Version 3.2.3, die man <a href="https://cran.r-project.org/bin/windows/base/old/3.2.3/">hier</a> herunterladen kann. Außerdem muss man eine Lizenz besitzen. An der Universität Hohenheim gibt es diese im ILIAS und man muss auch nach der Installation mit dem Hohenheimer VPN verbunden sein, damit das package funktioniert. Der Code dieses Beispiels ist auch <a href="https://github.com/SchmidtPaul/useful/tree/master/nlmeVSasreml">hier</a> auf meinem GitHub verfügbar.</p>
</div>
<div id="id-unabhangige-homogene-varianzen" class="section level2">
<h2>ID: unabhängige, homogene Varianzen</h2>
<div class="row">
<div class="col-md-6">
<h3 id="nlme">nlme</h3>
<pre class="r"><code>gls.id &lt;- gls(y ~ week + week*gen + week*rep,
              data=repmes)
gls.id$sigma^2 # ID.var</code></pre>
<pre><code>## [1] 0.02317583</code></pre>
</div>
<div class="col-md-6">
<h3 id="asreml-r-v3">asreml-R v3</h3>
<pre class="r"><code>asr.id &lt;- asreml(data  = repmes,
                 fixed = y ~ week + week:gen + week:rep)
summary(asr.id)$varcomp[,c(2,3,5)] # ID.var</code></pre>
</div>
</div>
</div>
<div id="diag-unabhangige-heterogene-varianzen" class="section level2">
<h2>DIAG: unabhängige, heterogene Varianzen</h2>
<div class="row">
<div class="col-md-6">
<h3 id="nlme-1">nlme</h3>
<pre class="r"><code>gls.dg &lt;- gls(y ~ week + week*gen + week*rep,
              weights = varIdent(form = ~ 1|week),
              data=repmes)
c(gls.dg$sigma^2, coef(gls.dg$modelStruct$varStruct, unconstrained=T)) # DG.vars</code></pre>
<pre><code>## [1] 0.01974885 0.02024967 0.06080366 0.25203986 0.02035091</code></pre>
</div>
<div class="col-md-6">
<h3 id="asreml-r-v3-1">asreml-R v3</h3>
<pre class="r"><code>asr.dg &lt;- asreml(data  = repmes,
                 fixed = y ~ week + week:gen + week:rep,
                 rcov  = ~ at(week):plot)
summary(asr.dg)$varcomp[,c(2,3,5)] # DG.vars</code></pre>
</div>
</div>
</div>
<div id="ar1-first-order-autoregressive" class="section level2">
<h2>AR1: first order autoregressive</h2>
<div class="row">
<div class="col-md-6">
<h3 id="nlme-2">nlme</h3>
<pre class="r"><code>gls.ar &lt;- gls(y ~ week + week*gen + week*rep,
              corr = corExp(form = ~ week|plot),
              data=repmes)
gls.ar$sigma^2 # AR1.var </code></pre>
<pre><code>## [1] 0.02317583</code></pre>
<pre class="r"><code>as.numeric(exp(-1/coef(gls.ar$modelStruct$corStruct, unconstrained=F))) # AR1.cor</code></pre>
<pre><code>## [1] 0.7776763</code></pre>
</div>
<div class="col-md-6">
<h3 id="asreml-r-v3-2">asreml-R v3</h3>
<pre class="r"><code>asr.ar &lt;- asreml(data  = repmes,
                 fixed = y ~ week + week:gen + week:rep,
                 rcov  = ~ ar1(week):plot)
summary(asr.ar)$varcomp[,c(2,3,5)] # AR var + cor</code></pre>
</div>
</div>
</div>
<div id="cs-compound-symmetry" class="section level2">
<h2>CS: compound symmetry</h2>
<div class="row">
<div class="col-md-6">
<h3 id="nlme-3">nlme</h3>
<pre class="r"><code>gls.cs &lt;- gls(y ~ week + week*gen + week*rep,
              corr  = corCompSymm(form = ~ week|plot),
              data=repmes)
gls.cs$sigma^2 # CS.var </code></pre>
<pre><code>## [1] 0.02317584</code></pre>
<pre class="r"><code>as.numeric(coef(gls.cs$modelStruct$corStruct, unconstrained=F)) # CS.cor</code></pre>
<pre><code>## [1] 0.7007553</code></pre>
</div>
<div class="col-md-6">
<h3 id="asreml-r-v3-3">asreml-R v3</h3>
<pre class="r"><code>asr.cs &lt;- asreml(data  = repmes,
                 fixed = y ~ week + week:gen + week:rep,
                 rcov  = ~ cor(week):plot)
summary(asr.cs)$varcomp[,c(2,3,5)] # CS var + cor</code></pre>
</div>
</div>
</div>
<div id="un-unstrukturiert" class="section level2">
<h2>UN: unstrukturiert</h2>
<div class="row">
<div class="col-md-6">
<h3 id="nlme-4">nlme</h3>
<pre class="r"><code>gls.un &lt;- gls(y ~ week + week*gen + week*rep,
              corr    =  corSymm(form = ~ 1|plot),
              weights = varIdent(form = ~ 1|week),
              data=repmes)
c(gls.un$sigma^2, coef(gls.un$modelStruct$varStruct, unconstrained=T)) # UN.vars</code></pre>
<pre><code>## [1] 0.01974916 0.02023961 0.06079338 0.25202993 0.02034066</code></pre>
<pre class="r"><code>gls.un$modelStruct$corStruct # UN.cors</code></pre>
<pre><code>## Correlation structure of class corSymm representing
##  Correlation: 
##   1     2     3     4    
## 2 0.708                  
## 3 0.644 0.634            
## 4 0.748 0.744 0.934      
## 5 0.534 0.549 0.718 0.776</code></pre>
</div>
<div class="col-md-6">
<h3 id="asreml-r-v3-4">asreml-R v3</h3>
<pre class="r"><code>asr.un &lt;- asreml(data  = repmes,
                 fixed = y ~ week + week:gen + week:rep,
                 rcov  = ~ us(week):plot)
summary(asr.un)$varcomp[, c(2,3,5)] # UN vars + cors</code></pre>
</div>
</div>
</div>
</div>
<div id="komplexere-varianzsstrukturen" class="section level1">
<h1>Komplexere Varianzsstrukturen</h1>
<p>In <code>asreml</code>, nicht aber in <code>nlme</code>, ist es möglich komplexere Varianzsstrukturen zu erzeugen. So können bis zu 3 Varianzstrukturmatrizen mittels Kronecker-Produkt miteinander kombiniert werden. Siehe dazu Seite 11 der “asreml-R.pdf” package Dokumentation, sowie die Beispielcodes <a href="https://github.com/SchmidtPaul/useful/blob/master/nlmeVSasreml/VarCovStructures2.R">hier</a>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
