<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>1 Beh.faktor - RCBD - Messwiederholungen</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 54px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h2 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h3 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h4 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h5 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h6 {
  padding-top: 59px;
  margin-top: -59px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">crashcouRse</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Kapitel
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="1F_crd.html">1) 1F crd</a>
    </li>
    <li>
      <a href="1F_rcbd.html">2) 1F rcbd</a>
    </li>
    <li>
      <a href="1F_alpha.html">3) 1F alpha</a>
    </li>
    <li>
      <a href="2F_rcbd.html">4) 2F rcbd</a>
    </li>
    <li>
      <a href="2F_splitplot.html">5) 2F split-plot</a>
    </li>
    <li>
      <a href="1F_rcbd_messwdh.html">6) 1F rcbd Messwiederholungen</a>
    </li>
    <li>
      <a href="1F_rcbd_binomial.html">7) 1F crd Prozentwerte</a>
    </li>
    <li>
      <a href="1F_latsq_poisson.html">8) 1F lat square Zählwerte</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="appendix_desplot.html">1) desplot package</a>
    </li>
    <li>
      <a href="appendix_designs.html">2) Versuchsdesigns</a>
    </li>
    <li>
      <a href="appendix_posthoc.html">3) ANOVA &amp; Post Hoc</a>
    </li>
    <li>
      <a href="appendix_interaktionen.html">4) Interaktionen</a>
    </li>
    <li>
      <a href="appendix_kovarstrukt.html">5) Kovarianzstrukturen</a>
    </li>
    <li>
      <a href="intro_GLM_carrot.html">6) Nicht-Normalverteilte Daten</a>
    </li>
    <li>
      <a href="appendix_modelrules.html">7) Modelle aufstellen</a>
    </li>
  </ul>
</li>
<li>
  <a href="kontaktseite.html">Kontakt</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">1 Beh.faktor - RCBD - Messwiederholungen</h1>

</div>


<pre class="r"><code>library(data.table) # bessere Datenmanipulation
library(nlme)    # generalisiertes Modell package
library(emmeans) # adjustierte Mittelwerte
library(ggplot2) # bessere Plots</code></pre>
<div id="datensatz" class="section level1">
<h1>Datensatz</h1>
<p>In diesem Experiment wurde in einer randomisierten vollständigen Blockanlage (RCBD) mit 5 Wiederholungen der Blattflächenindex von 4 Sorghumsorten verglichen. Allerdings wurde der Blattflächenindex mehrfach, nämlich in 5 aufeinanderfolgenden Wochen, gemessen, sodass Messwiederholungen vorliegen.</p>
<blockquote>
<p>Dieses Beispiel basiert auf <em>Example 4</em> des <code>agriTutorial</code> packages und der dazugehörigen Veröffentlichung <br /> Piepho, H. P., &amp; Edmondson, R. N. (2018). A tutorial on the statistical analysis of factorial experiments with qualitative and quantitative treatment factor levels. Journal of Agronomy and Crop Science.</p>
</blockquote>
<p><img src="1F_rcbd_messwdh_files/figure-html/unnamed-chunk-3-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Messwiederholungen werfen eine Neuerung gegenüber den vorangegangenen Beispielen auf: zum ersten Mal ist die kleinste Randomisationseinheit (=Parzelle) nicht gleichzeitig die Beobachtungseinheit, da wir mehrere Beobachtungen pro Parzelle haben. Der wichtige Punkt hier ist, dass der Faktor Woche nicht randomisiert werden kann. Statt der üblichen Annahme von unabhängigen Messwerten, sind Messwerte derselben Parzelle von aufeinanderfolgenden Wochen wahrscheinlich miteinander korreliert. Um dies zu modellieren, soll im ersten Schritt vorerst das Modell für die Analyse einer einzelnen Woche aufgestellt werden.</p>
<div class="row">
<div class="col-md-6">
<pre class="r"><code>print(repmes, nrows=10)</code></pre>
<pre><code>##      week gen  rep   plot    y
##   1:    1   A rep1  plot1 5.00
##   2:    1   D rep1  plot2 5.86
##   3:    1   B rep1  plot3 5.82
##   4:    1   C rep1  plot4 5.65
##   5:    1   C rep2  plot5 5.39
##  ---                          
##  96:    5   B rep4 plot16 3.99
##  97:    5   D rep5 plot17 2.96
##  98:    5   C rep5 plot18 3.00
##  99:    5   B rep5 plot19 2.95
## 100:    5   A rep5 plot20 2.16</code></pre>
</div>
<div class="col-md-6">
<pre class="r"><code>str(repmes)</code></pre>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   100 obs. of  5 variables:
##  $ week: Factor w/ 5 levels &quot;1&quot;,&quot;2&quot;,&quot;&quot;..
##  $ gen : Factor w/ 4 levels &quot;A&quot;,&quot;B&quot;,&quot;&quot;..
##  $ rep : Factor w/ 5 levels &quot;rep1&quot;,&quot;r&quot;..
##  $ plot: Factor w/ 20 levels &quot;plot1&quot;,&quot;..
##  $ y   : num  5 5.86 5.82 5.65 5.39 4...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;exter..</code></pre>
</div>
</div>
</div>
<div id="schlieende-statistik" class="section level1">
<h1>Schließende Statistik</h1>
<div id="analyse-einer-einzelnen-woche" class="section level2">
<h2>Analyse einer einzelnen Woche</h2>
<p>Wenn wir jede Woche separat analysieren, umgehen wir das Problem der korrelierten Messwerte und können das übliche Modell für eine einfaktorielle Varianzanalyse in einem RCBD aufstellen ( <a href="1F_rcbd.html">siehe Beispiel</a> ).</p>
<div id="manuelles-wahlen-der-woche" class="section level3">
<h3>Manuelles wählen der Woche</h3>
<p>Dann müssen wir lediglich einen Teildatensatz mit den Daten von nur einer Woche erstellen und auswerten.</p>
<pre class="r"><code>repmes.wk1 &lt;- repmes[week==&quot;1&quot;] # Nur Daten der ersten Woche
mod.wk1 &lt;- lm(y ~ gen + rep, data=repmes.wk1)
anova(mod.wk1)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## gen        3 2.7604 0.92012   46.59 6.918e-07 ***
## rep        4 8.3190 2.07974  105.31 3.086e-09 ***
## Residuals 12 0.2370 0.01975                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>So erhalten wir also die Ergebnisse der Varianzanalyse für die erste Woche und könnten wie gewohnt fortfahren indem wir adjustierte Mittelwerte für den signifikanten Faktor Sorte berechnen.</p>
</div>
<div id="analyse-in-einem-loop" class="section level3">
<h3>Analyse in einem Loop</h3>
<p>Anstatt die 5 Teildatensätze der 5 Wochen separat und manuell zu erstellen, können wir eine Schleife (<em>Loop</em>) schreiben, die automatisch eine Woche nach der anderen analysiert. Zusätzlich können wir in R eine <em>Liste</em> erstellen, in der die Ergebnisse aller durch den Loop generierten Varianzanalysen gespeichert werden.</p>
<pre class="r"><code>anova.liste &lt;- list() # erstelle ein leeres Listenobjekt

for (wochen.nr in c(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;)){ # Loop Anfang
  repmes.wkX &lt;- repmes[week==wochen.nr]
  mod.wkX &lt;- lm(y ~ gen + rep, data=repmes.wkX)
  anova.liste[[wochen.nr]] &lt;- anova(mod.wkX)
} # Loop Ende

anova.liste[[&quot;1&quot;]] # Zeige ANOVA der 1. Woche</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## gen        3 2.7604 0.92012   46.59 6.918e-07 ***
## rep        4 8.3190 2.07974  105.31 3.086e-09 ***
## Residuals 12 0.2370 0.01975                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova.liste[[&quot;5&quot;]] # Zeige ANOVA der 5. Woche</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## gen        3 5.9977 1.99924  97.196 1.099e-08 ***
## rep        4 4.3410 1.08526  52.762 1.619e-07 ***
## Residuals 12 0.2468 0.02057                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="analyse-des-gesamten-datensatzes" class="section level2">
<h2>Analyse des gesamten Datensatzes</h2>
<p><img src="images/fig6corerr.PNG" style="width:50%" align="right"> Der Nachteil der separaten Analyse einzelner Wochen wird besonders deutlich, wenn wir uns vorstellen, dass wir Messwerte von sehr viel mehr Wochen hätten, deren ANOVAs nicht immer die gleichen Signifikanzen zeigen: Es kann schwierig sein eine wochenübergreifende Antwort zu geben. Außerdem wurde durch das separate Analysieren auch immer nur ein Bruchteil der Informationen genutzt. Demnach ist es erstrebenswert den Datensatz als Ganzes mit einem geeigneten Modell auszuwerten. Dafür müssen wir Korrelationen zwischen den Fehlertermen verschiedener Wochen erlauben. Die Grafik, die aus dem oben erwähnten Artikel stammt, soll dies verdeutlichen.</p>
<div id="die-ar1-kovarianzstruktur" class="section level3">
<h3>Die AR1 Kovarianzstruktur</h3>
<p>Standardmäßig haben lineare Modelle unabhängige, identisch verteilte Fehler (<em>independent and identically distributed</em>, kurz <em>IID</em>). Um also nun korrelierte Fehler zu modellieren, kann man eine Kovarianstruktur für die Fehler annehmen. Es gibt verschiedene Kovarianstrukturen ( <a href="appendix_kovarstrukt.html">siehe hier</a> ), wobei die wahrscheinlich populärste für Messwiederholungen den Namen <em>first order autoregressive</em>, kurz <em>AR1</em> trägt.</p>
<p>Um lineare Modelle anzupassen, die eine andere Kovarianstruktur als <em>IID</em> annehmen, wird die <em>Verallgemeinerte Kleinste-Quadrat-Schätzung</em> (engl. <em>generalized least squares</em> kurz <em>GLS</em>) angewandt. Das <code>nlme</code> package hat dafür die Funktion <code>gls()</code>. Um das hier benötigte Modell aufzustellen können wir vorerst mit dem dem Modell aus der separaten Analyse der Wochen beginnen: <code>y ~ gen + rep</code>. Zur Erinnerung: Auch wenn wir es nicht explizit ins Modell geschrieben haben, so wird standardmäßig auch ein Intercept <span class="math inline">\(\mu\)</span> angepasst. Um dieses Modell für die Analyse mehrere Wochen zu erweitern, können wir jeden Effekt (also auch <span class="math inline">\(\mu\)</span>) zusätzlich wochenspezifisch definieren: <code>y ~ week + gen + week*gen + rep + week*rep</code>. Wir erhalten nun also zusätzlich je ein Intercept, einen Genotyp-Effekt und einen Wiederholungseffekt pro Woche. Man kann die Syntax für dieses Modell wie folgt abkürzen und trotzdem dieselben Effekte anpassen lassen:</p>
<pre class="r"><code>mod.iid &lt;- gls(y ~ week * (gen + rep),
               data = repmes)</code></pre>
<p>Schließlich wollen wir noch dafür sorgen, dass die Fehler derselben Parzelle zwsichen den Wochen autokorreliert sind, was mit dem Argument <code>corr = corExp(form = ~ week|plot)</code> funktioniert.</p>
<pre class="r"><code>mod.ar1 &lt;- gls(y ~ week * (gen + rep),
               corr = corExp(form = ~ week|plot),
               data = repmes)</code></pre>
<p>Wir können die geschätzten Fehlervarianzen und -korrelationen einsehen:</p>
<div class="row">
<div class="col-md-6">
<pre class="r"><code>mod.iid$sigma^2 # IID.var </code></pre>
<pre><code>## [1] 0.02317583</code></pre>
</div>
<div class="col-md-6">
<pre class="r"><code>mod.ar1$sigma^2 # AR1.var </code></pre>
<pre><code>## [1] 0.02317583</code></pre>
</div>
</div>
<pre class="r"><code>as.numeric(exp(-1/coef(mod.ar1$modelStruct$corStruct, unconstrained=F))) # AR1.cor</code></pre>
<pre><code>## [1] 0.7776763</code></pre>
<p>Die Korrelation wurde also auf 0.78 geschätzt, was darauf hindeutet, dass diese Kovarianstruktur in der Tat für die Modellierung der Daten geeignet ist. Um in solchen Fällen zu entscheiden ob das AR1-Modell tatsächlich dem IID-Modell vorzuziehen ist, können hier die AIC (<em>Akaike Information Criterion</em>) Werte verglichen werden. Dabei gilt, dass das Modell mit dem kleineren AIC-Wert das bessere ist. Zu beachten ist außerdem, dass nur Modelle, die die gleichen festen Effekte haben und dieselben Daten auswerten, mittels AIC-Wert verglichen werden sollten.</p>
<div class="row">
<div class="col-md-6">
<pre class="r"><code>AIC(mod.iid)</code></pre>
<pre><code>## [1] 78.26137</code></pre>
</div>
<div class="col-md-6">
<pre class="r"><code>AIC(mod.ar1)</code></pre>
<pre><code>## [1] 38.37925</code></pre>
</div>
</div>
<p>Der deutlich kleinere AIC-Wert bestätigt also die Vermutung, dass hier eine AR1 statt der üblichen IID Struktur für die Fehler angepasst werden sollte. Es muss klar sein, dass an dieser Stelle natürlich auch die AIC-Werte der Modelle mit <a href="appendix_kovarstrukt.html">anderen Kovarianstrukturen</a> verglichen werden könnten. Dies soll hier allerdings nicht getan werden um das Beispiel kurz zu halten.</p>
</div>
<div id="varianzanalyse" class="section level3">
<h3>Varianzanalyse</h3>
<p>Schließlich können wir wie gewohnt eine ANOVA durchführen, um den F-Test für den Behandlungsfaktor durchzuführen - nur eben für das selektierte AR1-Modell. Residuenplots kann man für <code>gls()</code> Objekte z.B. via <code>plot(mod.ar)</code> und <code>qqnorm(resid(mod.ar)); qqline(resid(mod.ar))</code> erhalten.</p>
<pre class="r"><code>anova(mod.ar1)</code></pre>
<pre><code>## Denom. DF: 60 
##             numDF   F-value p-value
## (Intercept)     1 21284.944  &lt;.0001
## week            4   738.198  &lt;.0001
## gen             3    88.053  &lt;.0001
## rep             4    94.361  &lt;.0001
## week:gen       12    14.975  &lt;.0001
## week:rep       16     6.077  &lt;.0001</code></pre>
<p>Alle Effekte sind laut F-Test signifikant, relevant ist dabei aber vor allem <code>week:gen</code>. Analog zur Vorgehensweise bei einer signifikanten Wechselwirkung von zwei Behandlungseffekten (<a href="2F_splitplot.html">siehe hier</a>) gilt auch hier, dass die adjustierten Mittelwerte für <code>week:gen</code> und nicht für <code>gen</code> berechnet werden sollten.</p>
</div>
<div id="multipler-mittelwertvergleich" class="section level3">
<h3>Multipler Mittelwertvergleich</h3>
<pre class="r"><code>means &lt;- emmeans(mod.ar1, pairwise ~ gen|week, adjust=&quot;tukey&quot;) # adjust=&quot;none&quot; für t-test
means &lt;- CLD(means$emmeans, details=TRUE, Letters=letters)</code></pre>
<pre><code>## Warning: &#39;CLD&#39; will be deprecated. Its use is discouraged.
## See &#39;? CLD&#39; for an explanation. Use &#39;pwpp&#39; or &#39;multcomp::cld&#39; instead.</code></pre>
<pre class="r"><code>means$emmeans # Sorten-Mittelwerte pro Woche</code></pre>
<pre><code>## week = 1:
##  gen emmean     SE   df lower.CL upper.CL .group
##  A     4.24 0.0681 18.2     4.10     4.38  a    
##  C     4.89 0.0681 19.5     4.75     5.03   b   
##  B     5.15 0.0681 19.5     5.01     5.29    c  
##  D     5.15 0.0681 18.2     5.01     5.30    c  
## 
## week = 2:
##  gen emmean     SE   df lower.CL upper.CL .group
##  A     4.05 0.0681 18.2     3.90     4.19  a    
##  D     4.94 0.0681 18.2     4.80     5.09   b   
##  B     4.98 0.0681 19.5     4.84     5.12   b   
##  C     5.07 0.0681 19.5     4.93     5.22   b   
## 
## week = 3:
##  gen emmean     SE   df lower.CL upper.CL .group
##  A     3.41 0.0681 18.2     3.26     3.55  a    
##  B     4.59 0.0681 19.5     4.45     4.74   b   
##  D     4.71 0.0681 18.2     4.56     4.85   b   
##  C     4.71 0.0681 19.5     4.57     4.86   b   
## 
## week = 4:
##  gen emmean     SE   df lower.CL upper.CL .group
##  A     3.09 0.0681 18.2     2.94     3.23  a    
##  B     4.22 0.0681 19.5     4.08     4.36   b   
##  D     4.39 0.0681 18.2     4.25     4.53   b   
##  C     4.48 0.0681 19.5     4.33     4.62   b   
## 
## week = 5:
##  gen emmean     SE   df lower.CL upper.CL .group
##  A     2.70 0.0681 18.2     2.56     2.84  a    
##  D     3.83 0.0681 18.2     3.69     3.98   b   
##  B     4.01 0.0681 19.5     3.87     4.15   b   
##  C     4.02 0.0681 19.5     3.88     4.16   b   
## 
## Results are averaged over the levels of: rep 
## d.f. method: satterthwaite 
## Confidence level used: 0.95 
## P value adjustment: tukey method for comparing a family of 4 estimates 
## significance level used: alpha = 0.05</code></pre>
<p>Wie der im F-Test signifikante <code>week:gen</code> Effekt schon vermuten ließ, finden wir für die Sortenmittelwerte je Woche unterschiedliche Buchstabendarstellungen oder anders gesagt: Wochen-spezifische Unterschiede zwischen den Sorten. Allerdings sehen wir beispielsweise auch, dass Sorte A in jeder Woche signifikant schlechter ist als alle anderen Sorten.</p>
</div>
</div>
</div>
<div id="ergebnisaufbereitung" class="section level1">
<h1>Ergebnisaufbereitung</h1>
<p>Analog zu <a href="2F_splitplot.html">diesem Beispiel</a> können wir die Ergebnisse grafisch wie folgt aufbereiten:</p>
<pre class="r"><code>means.plot &lt;- as.data.table(means$emmeans) # korrektes Format für ggplot

ggplot(data=means.plot, aes(x=gen)) +
  geom_bar(aes(y=emmean, fill=gen), stat=&quot;identity&quot;, width=0.8) + 
  guides(fill=FALSE) + 
  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.4) +
  geom_text(aes(y=emmean*1.1, label=.group)) +
  facet_wrap(~week) + # ein Plot pro Woche
  theme_bw() +
  labs(main=&quot;Adj. Sortenmittelwerte pro Woche&quot;,
       y=&quot;Adjustierter Ertragsmittelwert ± 95% Konfidenzintervall&quot;, x=&quot;Sorte&quot;,
       caption=&quot;Getrennt für jede Woche gilt: Mittelwerte, die mit einem gemeinsamen Buchstaben versehen sind,\n sind laut Tukey-test nicht signifikant voneinander verschieden.&quot;)</code></pre>
<p><img src="1F_rcbd_messwdh_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>oder alternativ:</p>
<pre class="r"><code>ggplot() +
  # Rohdaten (lemna)
  geom_jitter( data=repmes, aes(x=gen, y=y, fill=gen), width=0.15, height=0, shape=21) +
  # Ergebnisse (plot.means)
  geom_point(   data=means.plot, aes(x=as.numeric(gen)+0.4, y=emmean), col=&quot;red&quot;, shape=16, size=2) +
  geom_errorbar(data=means.plot, aes(x=as.numeric(gen)+0.4, ymin=lower.CL, ymax=upper.CL), col=&quot;red&quot;, width=0.3) +
  geom_text(    data=means.plot, aes(x=gen, y=6.5, label =.group), col=&quot;red&quot;) +
  facet_wrap(~week) + # ein Plot pro Woche
  theme_bw() +
  labs(main=&quot;Adj. Sortenmittelwerte pro Woche&quot;,
       y=&quot;Adjustierter Ertragsmittelwert ± 95% Konfidenzintervall&quot;, x=&quot;Sorte&quot;,
       caption=&quot;Getrennt für jede Woche gilt: Mittelwerte, die mit einem gemeinsamen Buchstaben versehen sind,\n sind laut Tukey-test nicht signifikant voneinander verschieden.&quot;)</code></pre>
<p><img src="1F_rcbd_messwdh_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
