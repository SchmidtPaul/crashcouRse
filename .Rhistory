p
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+15, label="hello"))
p
p <- p + geom_text(aes(y=emmean+25, label="hello"))
p
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+25, label="hello"))
p
p
means$emmeans
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+15, label=.group))
p
CLD(means$emmeans, details=T, Letters=letters)
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
crd <- fread("04 crd variety.txt")
# format columns correctly
crd$Variety   <- as.factor(crd$Variety)
crd$Replicate <- as.factor(crd$Replicate)
# plot for first impression
plot(y=crd$Yield, x=crd$Variety)
# general linear model
# Step 1: Check F-Test of ANOVA
# Step 2: Compare adjusted means per level
mod <- lm(data    = crd,
formula = Yield ~ Variety)
anova(mod) # Analysis of variance
library(emmeans)
library(multcompView)
means <- emmeans(mod, pairwise ~ "Variety")
means <- CLD(means$emmeans, details=T, Letters=letters)
means
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
crd <- fread("04 crd variety.txt")
# format columns correctly
crd$Variety   <- as.factor(crd$Variety)
crd$Replicate <- as.factor(crd$Replicate)
# plot for first impression
plot(y=crd$Yield, x=crd$Variety)
# general linear model
# Step 1: Check F-Test of ANOVA
# Step 2: Compare adjusted means per level
mod <- lm(data    = crd,
formula = Yield ~ Variety)
anova(mod) # Analysis of variance
library(emmeans)
library(multcompView)
means <- emmeans(mod, pairwise ~ "Variety")
means <- CLD(means$emmeans, details=T, Letters=letters)
library(ggplot2)
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+15, label=.group))
p
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
crd <- fread("04 crd variety.txt")
# format columns correctly
crd$Variety   <- as.factor(crd$Variety)
crd$Replicate <- as.factor(crd$Replicate)
# plot for first impression
plot(y=crd$Yield, x=crd$Variety)
# general linear model
# Step 1: Check F-Test of ANOVA
# Step 2: Compare adjusted means per level
mod <- lm(data    = crd,
formula = Yield ~ Variety)
anova(mod) # Analysis of variance
library(emmeans)
library(multcompView)
means <- emmeans(mod, pairwise ~ "Variety")
means <- CLD(means$emmeans, details=T, Letters=letters)
library(ggplot2)
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+15, label=.group))
p
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
crd <- fread("04 rcbd variety.txt")
# format columns correctly
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd <- fread("04 rcbd variety.txt")
# format columns correctly
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd <- fread("04 rcbd variety.txt")
# format columns correctly
rcbd$Variety <- as.factor(rcbd$Variety)
rcbd$Block   <- as.factor(rcbd$Block)
View(rcbd)
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd <- fread("04 rcbd variety.txt")
# format columns correctly
rcbd$Variety <- as.factor(rcbd$Variety)
rcbd$Block   <- as.factor(rcbd$Block)
# general linear model
# Step 1: Check F-Test of ANOVA
# Step 2: Compare adjusted means per level
mod <- lm(data    = rcbd,
formula = Yield ~ Variety + Block)
anova(mod) # anova
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd <- fread("04 rcbd variety.txt")
# format columns correctly
rcbd$Variety <- as.factor(rcbd$Variety)
rcbd$Block   <- as.factor(rcbd$Block)
# general linear model
# Step 1: Check F-Test of ANOVA
# Step 2: Compare adjusted means per level
mod <- lm(data    = rcbd,
formula = Yield ~ Variety + Block)
anova(mod) # analysis of variance
library(emmeans)
library(multcompView)
means <- emmeans(mod, pairwise ~ "Variety")
means <- CLD(means$emmeans, details=T, Letters=letters)
library(ggplot2)
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+15, label=.group))
p
library(ggfortify)
autplot(mod)
autoplot(mod)
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd <- fread("04 rcbd variety.txt")
# format columns correctly
rcbd$Variety <- as.factor(rcbd$Variety)
rcbd$Block   <- as.factor(rcbd$Block)
# general linear model
# Step 1: Check F-Test of ANOVA
# Step 2: Compare adjusted means per level
mod <- lm(data    = rcbd,
formula = Yield ~ Variety + Block)
anova(mod) # analysis of variance
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd2 <- fread("04 rcbd variety nitrogen.txt")
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd2 <- fread("04 rcbd variety nitrogen.txt")
# format columns correctly
rcbd2$Variety    <- as.factor(rcbd2$Variety)
rcbd2$Fertilizer <- as.factor(rcbd2$Fertilizer)
rcbd2$Block      <- as.factor(rcbd2$Block)
View(rcbd2)
# plots for first impression
plot(y=rcbd2$Yield, x=rcbd2$Variety)
plot(y=rcbd2$Yield, x=rcbd2$Fertilizer)
boxplot(data=rcbd2, Yield ~ Variety + Fertilizer)
boxplot(data=rcbd2, Yield ~ Variety + Fertilizer, las=2)
# plots for first impression
plot(y=rcbd2$Yield, x=rcbd2$Variety)
plot(y=rcbd2$Yield, x=rcbd2$Fertilizer)
boxplot(data=rcbd2, Yield ~ Variety + Fertilizer, las=2)
boxplot(data=rcbd2, Yield ~ Variety + Fertilizer)
boxplot(data=rcbd2, Yield ~ Variety + Fertilizer, las=2)
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd2 <- fread("04 rcbd variety nitrogen.txt")
# format columns correctly
rcbd2$Variety    <- as.factor(rcbd2$Variety)
rcbd2$Fertilizer <- as.factor(rcbd2$Fertilizer)
rcbd2$Block      <- as.factor(rcbd2$Block)
# plots for first impression
plot(y=rcbd2$Yield, x=rcbd2$Variety)
plot(y=rcbd2$Yield, x=rcbd2$Fertilizer)
boxplot(data=rcbd2, Yield ~ Variety + Fertilizer, las=2)
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd2 <- fread("04 rcbd variety nitrogen.txt")
# format columns correctly
rcbd2$Variety    <- as.factor(rcbd2$Variety)
rcbd2$Fertilizer <- as.factor(rcbd2$Fertilizer)
rcbd2$Block      <- as.factor(rcbd2$Block)
# plots for first impression
plot(y=rcbd2$Yield, x=rcbd2$Variety)
plot(y=rcbd2$Yield, x=rcbd2$Fertilizer)
boxplot(data=rcbd2, Yield ~ Variety + Fertilizer, las=2)
# Full model
mod <- lm(data    = rcbd2,
formula = Yield ~ Variety + Fertilizer +
Variety:Fertilizer + Block)
anova(mod)
anova(mod2)
mod2 <- update(mod, . ~ . -Variety:Fertilizer)
anova(mod2)
# Reduced model
mod2 <- update(mod, . ~ . -Variety:Fertilizer)
anova(mod2)
# Further reduced model
mod3 <- update(mod2, . ~ . -Fertilizer)
anova(mod3)
anova(mod)
anova(mod2) # Fertilizer is n.s.
library(emmeans)
library(multcompView)
means <- emmeans(mod, pairwise ~ "Variety")
means <- CLD(means$emmeans, details=T, Letters=letters)
library(ggplot2)
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+15, label=.group))
p
library(emmeans)
library(multcompView)
means <- emmeans(mod3, pairwise ~ "Variety")
means <- CLD(means$emmeans, details=T, Letters=letters)
library(ggplot2)
p <- ggplot(data=means$emmeans, aes(x=Variety))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+15, label=.group))
p
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
rcbd <- fread("05 split plot variety nitrogen.txt")
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sp <- fread("05 split plot variety nitrogen.txt")
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sp <- fread("05 split plot variety nitrogen.txt")
View(sp)
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sp <- fread("05 split plot variety nitrogen.txt")
# format columns correctly
sp$Block <- as.factor(sp$Block)
sp$Var   <- as.factor(sp$Var)
sp$N     <- as.factor(sp$N)
sp$Block
sp$Block
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sp <- fread("05 split plot variety nitrogen.txt")
# format columns correctly
sp$Block <- as.factor(sp$Block)
sp$Var   <- as.factor(sp$Var)
sp$N     <- as.factor(sp$N)
# plot for first impression
boxplot(data=sp, Yield ~ Var + N, las=2)
# plot for first impression
boxplot(data=sp, Yield ~ N + Var, las=2)
# plot for first impression
boxplot(data=sp, Yield ~ N + Var, las=2,
col=N)
# plot for first impression
boxplot(data=sp, Yield ~ N + Var, las=2)
# general linear model
mod <- lm(data    = sp,
formula = Yield ~ N + Var + N:Var + Block)
mod
View(sp)
sp$mainplot <- paste0(sp$Block, sp$N)
sp
paste0(sp$Block, sp$N)
View(sp)
View(sp)
sp$mainplot <- paste0("B", sp$Block, "-N", sp$N)
View(sp)
sp$mainplot <- as.factor(paste0("B", sp$Block, "-N", sp$N))
library(lme4)
library(lmerTest)
paste("eins", "zwei")
paste0("eins", "zwei")
paste("eins", "zwei", sep = "-")
paste("eins", "zwei", "drei", sep = "-")
paste("eins", "zwei", "drei", sep = "nummer")
2+2
2+2     3*3
2+2 ;    3*3
# general linear mixed model
library(lme4); library(lmerTest)
mod <- lmer(data    = sp,
formula = Yield ~ N + Var + N:Var + Block +
(1|Block:mainplot) )
mod <- lmer(data    = sp,
formula = Yield ~ N + Var + N:Var + Block +
(1|Block:mainplot) )
anova(mod)
# adjusted means
library(emmeans)
means <- emmeans(mod, pairwise ~ N | Var)
means <- emmeans(mod, pairwise ~ N | Var, adjust="tukey")
means <- emmeans(mod, pairwise ~ N | Var)
means
means <- emmeans(mod, pairwise ~ N : Var)
means
means
means <- emmeans(mod, pairwise ~ N | Var)
means
CLD(means$emmeans, details=T, Letters=letters)
means <- CLD(means$emmeans, details=T, Letters=letters)
means
means$emmeans
as.data.table(means$emmeans)
library(emmeans);
means <- emmeans(mod, pairwise ~ N | Var)
means <- CLD(means$emmeans, details=T, Letters=letters)
means <- as.data.table(means$emmeans)
p <- ggplot(data=output, aes(x=N))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~Var) # one per variety
p # show plot
library(ggplot2)
p <- ggplot(data=output, aes(x=N))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~Var) # one per variety
p # show plot
p <- ggplot(data=means, aes(x=N))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~Var) # one per variety
p # show plot
means <- emmeans(mod, pairwise ~ Var | N)
means <- CLD(means$emmeans, details=T, Letters=letters)
means <- as.data.table(means$emmeans) # reformatting into one table
means
emmeans(mod, pairwise ~ Var | N)
means <- emmeans(mod, pairwise ~ Var | N)
means <- CLD(means$emmeans, details=T, Letters=letters)
means <- as.data.table(means$emmeans) # reformatting into one table
p <- ggplot(data=means, aes(x=Var))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~N) # one per variety
p # show plot
means
p <- ggplot(data=means, aes(x=reorder(Var, emmean))
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~N) # one per variety
p # show plot
p <- ggplot(data=means, aes(x=reorder(Var, emmean))
p <- ggplot(data=means, aes(x=reorder(Var, emmean)))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~N) # one per variety
p # show plot
p <- ggplot(data=means, aes(x=reorder(Var, emmean)))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~N, nrow=1) # one per variety
p # show plot
p <- ggplot(data=means, aes(x=reorder(Var, emmean)))
p <- p + geom_bar(aes(y=emmean), stat="identity", width=0.8)
p <- p + geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.4)
p <- p + geom_text(aes(y=emmean+1500, label=.group))
p <- p + facet_wrap(~N) # one per variety
p # show plot
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sorghum <- fread("06 sorghum repeated measures.txt")
# format colums correctly
names(sorghum)
# format colums correctly
names(sorghum)[1:3]
# format colums correctly
names(sorghum)[2:3]
# format colums correctly
names(sorghum)[1:3]
# format colums correctly
makefactor <- names(sorghum)[1:3]
makefactor
makefactor
makefactor
makefactor
makefactor
sorghum[, (makefactor) := lapply(.SD, as.factor), .SDcols=makefactor]
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sorghum <- fread("06 sorghum repeated measures.txt")
# format colums correctly
makefactor <- names(sorghum)[1:3]
sorghum[, (makefactor) := lapply(.SD, as.factor), .SDcols=makefactor]
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sorghum <- fread("06 sorghum repeated measures.txt")
# format colums correctly
makefactor <- names(sorghum)[1:3]
sorghum[, (makefactor) := lapply(.SD, as.factor), .SDcols=makefactor]
rm(list=ls())
setwd("C:/Users/schmi/Desktop/R October/Datasets")
library(data.table)
sorghum <- fread("06 sorghum repeated measures.txt")
# format colums correctly
makefactor <- names(sorghum)[1:3]
sorghum[, (makefactor) := lapply(.SD, as.factor), .SDcols=makefactor]
makefactor
# rename column "rep" to "block"
names(sorghum)
# rename column "rep" to "block"
names(sorghum)[3]
# rename column "rep" to "block"
names(sorghum)[3] <- "block"
names(sorghum)
View(sorghum)
# plot for first impression
library(ggplot2)
ggplot(data=sorghum, aes(y=y, x=var, fill=week)) +
geom_boxplot()
sorghum[week=="1"]
anova(mod.wk1) # and so on ...
# Analyzing only week 1:
mod.wk1 <- lm(data    = sorghum[week=="1"],
formula = y ~ var + block)
anova(mod.wk1) # and so on ...
# Option 2: Analyze across weeks with correlated errors
library(nlme)
View(sorghum)
sorghum$plotID <- paste0(sorghum$var, sorghum$block)
sorghum$plotID <- as.factor(paste0(sorghum$var, sorghum$block))
sorghum$plotID <- as.factor(paste0(sorghum$var, sorghum$block))
mod.ar <- gls(data  = sorghum,
model = y ~ week + week*var + week*block,
corr  = corExp(form ~ week|plotID) )
mod.ar <- gls(data  = sorghum,
model = y ~ week + week*var + week*block,
corr  = corExp(form = ~ week|plotID) )
anova(mod.ar)
# general linear mixed model
library(lme4); library(lmerTest)
# Option 2: Analyze across weeks with correlated errors
library(nlme)
detach("package:lmerTest", unload=TRUE)
detach("package:lme4", unload=TRUE)
detach("package:nlme", unload=TRUE)
library("lme4", lib.loc="~/R/win-library/3.5")
library("lmerTest", lib.loc="~/R/win-library/3.5")
library("nlme", lib.loc="~/R/win-library/3.5")
anova(mod.ar)
rm(list=ls())
library(data.table) # better data handling
library(asreml)     # linear mixed model package
rm(list=ls())
library(data.table) # better data handling
library(asreml)     # linear mixed model package
library(nlme)       # linear mixed model package
# load example dataset from github
load(url("https://github.com/SchmidtPaul/useful/blob/master/nlmeVSasreml/sorghum%20repmes.rda?raw=true"))
### asreml() of asreml-package
##############################
repmes <- repmes[order(week)]   # data needs to be sorted correctly
repmes <- as.data.frame(repmes) # data needs to be a data.frame
repmes
# ID: independent, uncorrelated random plot error
asr.id <- asreml(data  = repmes,
fixed = y ~ week + week:gen + week:rep)
summary(asr.id)$varcomp[,c(2,3,5)] # ID.var
# DIAG: heterogeneous variances per week
asr.dg <- asreml(data  = repmes,
fixed = y ~ week + week:gen + week:rep,
rcov  = ~ at(week):plot)
summary(asr.dg)$varcomp[,c(2,3,5)] # DG.vars
library(asreml) # requires R version 3.2.3. and license
library(desplot)
data(nin89)
